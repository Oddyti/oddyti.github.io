<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='学习Java内存模型(JMM)的总结，包括运行时数据区、顺序一致性模型、happens-before原则、volatile关键字、锁机制、synchronized关键字'><title>Java内存模型(JMM) - 一篇不太详细的解释</title><link rel=canonical href=https://oddyti.com/post/jmm/><link rel=stylesheet href=/scss/style.min.37a29cbc65941461d9ba6496e3b0bbfac62fd1ebba93cc8dda0dcfe48b8a6190.css><meta property='og:title' content='Java内存模型(JMM) - 一篇不太详细的解释'><meta property='og:description' content='学习Java内存模型(JMM)的总结，包括运行时数据区、顺序一致性模型、happens-before原则、volatile关键字、锁机制、synchronized关键字'><meta property='og:url' content='https://oddyti.com/post/jmm/'><meta property='og:site_name' content='Oddyti的小站'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='JAVA'><meta property='article:published_time' content='2025-02-22T21:09:30+08:00'><meta property='article:modified_time' content='2025-02-22T21:09:30+08:00'><meta name=twitter:title content="Java内存模型(JMM) - 一篇不太详细的解释"><meta name=twitter:description content="学习Java内存模型(JMM)的总结，包括运行时数据区、顺序一致性模型、happens-before原则、volatile关键字、锁机制、synchronized关键字"><link rel="shortcut icon" href=/favicon2.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/snoopy_hu_8a95909abaef0cd8.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Oddyti的小站</a></h1><h2 class=site-description>是谁来自山川湖海，却囿于昼夜厨房与爱。</h2></div></header><ol class=social-menu><li><a href=https://space.bilibili.com/51329228 target=_blank title=Biligili rel=me><svg t="1698647251144" class="icon" viewBox="0 0 1024 1024" p-id="3988" width="200" height="200"><path d="M306.005333 117.632 444.330667 256h135.296l138.368-138.325333A42.666667 42.666667.0 01778.368 178.048L700.330667 256H789.333333A149.333333 149.333333.0 01938.666667 405.333333v341.333334A149.333333 149.333333.0 01789.333333 896H234.666667A149.333333 149.333333.0 0185.333333 746.666667V405.333333A149.333333 149.333333.0 01234.666667 256h88.96L245.632 177.962667a42.666667 42.666667.0 0160.373333-60.373334zm483.328 223.701333H234.666667a64 64 0 00-63.701334 57.856L170.666667 405.333333v341.333334a64 64 0 0057.856 63.701333L234.666667 810.666667h554.666666a64 64 0 0063.701334-57.856L853.333333 746.666667V405.333333a64 64 0 00-64-64zm-448 128A42.666667 42.666667.0 01384 512v85.333333a42.666667 42.666667.0 01-85.333333.0V512a42.666667 42.666667.0 0142.666666-42.666667zm341.333334.0A42.666667 42.666667.0 01725.333333 512v85.333333a42.666667 42.666667.0 01-85.333333.0V512a42.666667 42.666667.0 0142.666667-42.666667z" p-id="3989"/></svg></a></li><li><a href='https://music.163.com/#/user/home?id=556522560' target=_blank title=网易云 rel=me><svg t="1698647303353" class="icon" viewBox="0 0 1024 1024" p-id="5301" width="200" height="200"><path d="M616.64142222 49.16337778c25.14488889-7.24764445 52.08746667-6.88355555 77.48266667-1.04675556 29.16124445 6.92906667 56.75235555 20.32071111 80.49777778 38.57066667 8.66986667 6.58773333 16.49777778 14.77973333 20.48 25.088 6.16675555 15.24622222 4.51697778 33.47342222-4.58524445 47.2064-7.94168889 12.33351111-21.44711111 20.92373333-35.99928889 22.76693333-11.62808889 1.59288889-23.81368889-.87608889-33.80337778-7.05422222-5.632-3.31093333-9.92142222-8.41955555-15.57617777-11.69635555-15.16657778-9.6256-32.63146667-17.2032-50.8928-16.77084445-12.85688889.14791111-24.1664 7.68-32.88177778 16.53191111-8.15786667 8.41955555-12.31075555 20.83271111-9.61422222 32.38115556 6.26915555 23.59751111 12.50417778 47.19502222 18.76195555 70.79253333 44.98773333 2.30968889 89.95271111 14.21084445 128.62577778 37.69457778 37.59217778 23.25617778 71.55484445 52.74737778 98.48604444 87.89333333 22.85795555 29.78702222 40.18631111 63.80657778 50.7904 99.82862222 11.48017778 38.82097778 15.20071111 79.75822222 12.20835556 120.08106667-2.49173333 33.26862222-9.03395555 66.34382222-20.32071111 97.78062222-29.184 76.54968889-83.23982222 143.6672-152.81493333 187.16444445-51.02933333 32.23324445-109.63626667 51.67786667-169.40373334 59.09617778-41.25582222 5.15413333-83.29671111 5.17688889-124.34773333-1.85457778C369.37955555 939.67928889 290.32675555 897.6384 230.33173333 836.9152 170.71217778 777.18186667 129.21742222 699.65368889 112.4352 616.94862222c-12.37902222-60.3136-11.82151111-123.2896 1.91146667-183.33013333 16.78222222-74.0352 53.87377778-143.29173333 106.01813333-198.43982222 42.53013333-45.28355555 95.06133333-81.11217778 152.72391111-104.2432 5.9392-2.26417778 11.78737778-4.94933333 18.11342222-5.95057778 13.50542222-2.36657778 27.93244445.83057778 38.99164445 8.97706666 14.97315555 10.56995555 23.21066667 29.74151111 20.71893333 47.8776889C448.85333333 200.3512889 435.712 217.0424889 418.2016 223.37991111c-58.25422222 21.77706667-109.90933333 60.68906667-147.09191111 110.51235556-33.23448889 44.21404445-54.92053333 97.02968889-62.19093334 151.88195555-7.33866667 54.29475555-.80782222 110.36444445 18.64817778 161.56444445 28.10311111 74.8544 83.97937778 139.264 155.21564445 175.9232 42.89422222 22.2208 91.18151111 33.82613333 139.48017777 33.49617778 39.7312-.512 79.58755555-6.89493333 116.92942223-20.70755556 32.83626667-12.19697778 63.61315555-30.208 89.78204444-53.5552 24.39395555-21.61777778 44.69191111-47.74115555 60.17706667-76.40177778 7.75964445-14.62044445 14.92764445-29.67324445 19.30808889-45.68177778 12.92515555-45.76142222 15.16657778-95.35715555 1.34257777-141.18684444-11.43466667-38.43413333-34.96391111-72.69262222-65.01262222-99.00942222-13.28924445-11.62808889-27.48871111-22.28906667-42.71217778-31.25475556-13.44853333-7.55484445-28.13724445-12.6976-43.12177777-16.21333333 10.4448 40.84622222 21.61777778 81.52177778 32.21048889 122.33386667 1.79768889 9.78488889 3.59537778 19.56977778 5.27928888 29.37742222 1.54737778 42.10915555-13.22097778 84.52551111-40.37973333 116.736-25.30417778 30.35591111-61.2352 51.712-100.10168889 59.05066666-41.89297778 8.35128889-86.9376.46648889-122.91413333-22.75555555-34.34951111-21.77706667-59.72195555-56.26311111-73.10222222-94.43555556-7.5776-21.35608889-11.35502222-43.94097778-12.10595556-66.56-2.29831111-49.20888889 10.56995555-99.48728889 38.71857778-140.1856 33.0752-48.57173333 85.21955555-81.96551111 141.12995555-98.25848889-4.11875555-15.74684445-8.32853333-31.47093333-12.4928-47.21777778-10.79751111-33.98542222-8.4992-72.14648889 7.61173334-104.09528888 8.69262222-17.82897778 21.61777778-33.35964445 36.56817778-46.27342222 16.64568889-14.2336 36.07893333-25.47484445 57.26435555-31.30026667m-133.49546667 370.176c-14.99591111 15.74684445-25.50897778 35.65795555-30.03733333 56.91164444-4.07324445 19.29671111-4.096 39.41262222-.43235555 58.76622223 4.47146667 21.37884445 15.50791111 42.2912 33.80337778 54.90915555 14.19946667 10.08071111 32.68835555 13.14133333 49.62986666 9.8304 31.34577778-5.50684445 56.92302222-34.34951111 57.79911111-66.26417778-1.19466667-7.90755555-2.50311111-15.81511111-4.73315555-23.50648889-11.70773333-44.28231111-23.51786667-88.53048889-35.15733334-132.83555555-26.48746667 8.16924445-51.70062222 21.93635555-70.87217778 42.1888z" p-id="5302"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>主页</span></a></li><li><a href=/categories><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>分类</span></a></li><li><a href=/archives><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/tags><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg>
<span>标签</span></a></li><li><a href=/links><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>友链</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://oddyti.com/ selected>中文</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#java内存模型jmm>Java内存模型(JMM)</a><ol><li><a href=#运行时数据区>运行时数据区</a></li><li><a href=#java内存模型>Java内存模型</a><ol><li><a href=#顺序一致性模型-与-java-内存模型jmm>顺序一致性模型 与 Java 内存模型（JMM）</a></li><li><a href=#最小安全性>最小安全性</a></li><li><a href=#happens-before原则>happens-before原则</a></li><li><a href=#内存屏障>内存屏障</a></li><li><a href=#volatitle关键字>volatitle关键字</a></li></ol></li><li><a href=#锁与synchronized>锁与synchronized</a><ol><li><a href=#synchronized关键字>Synchronized关键字</a></li><li><a href=#class对象作为锁>Class对象作为锁</a></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E5%BC%84%E6%96%A7/>弄斧</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/jmm/>Java内存模型(JMM) - 一篇不太详细的解释</a></h2><h3 class=article-subtitle>学习Java内存模型(JMM)的总结，包括运行时数据区、顺序一致性模型、happens-before原则、volatile关键字、锁机制、synchronized关键字</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Feb 22, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读耗时: 11 分钟</time></div></footer></div></header><section class=article-content><h2 id=java内存模型jmm>Java内存模型(JMM)</h2><h3 id=运行时数据区>运行时数据区</h3><p><img src=/post/jmm/%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA.jpg width=552 height=383 loading=lazy alt=image class=gallery-image data-flex-grow=144 data-flex-basis=345px></p><p><strong>线程私有：</strong></p><ul><li><p>本地方法栈：用于管理本地方法的调用，里面并没有我们写的代码逻辑，其由native修饰，由 C 语言实现。</p></li><li><p>程序计数器：它是一块很小的内存空间，主要用来记录各个线程执行的字节码的地址，例如，分支、循环、线程恢复等都依赖于计数器。</p></li><li><p><strong>Java虚拟机栈</strong>：用于存储局部变量表、操作数栈、动态链接、方法出口等信息。（栈里面存的是地址，实际指向的是堆里面的对象）</p><ul><li>方法运行时的局部变量和操作数存储在 Java 虚拟机栈（JVM Stack）中，例如在方法穿进来的参数变量、方法中创建的变量、方法中创建的对象（存其指向堆对象的地址）。</li></ul></li></ul><p><strong>线程共有：</strong></p><ul><li><p><strong>堆</strong>：Java 虚拟机中内存最大的一块，是被所有线程共享的，几乎所有的对象实例都在这里分配内存；</p><ul><li>如创建对象时会在堆开辟空间存放对象，并将在虚拟机栈中存放该对象地址</li><li>如常量池在堆中开辟</li></ul></li><li><p>方法区（Java8叫元空间）：用于存放已被虚拟机加载的类信息，常量，静态变量等数据。</p><ul><li>方法区存储的是与类相关的元数据信息，包括类的结构（如类名、父类名、修饰符等）、字段信息、方法信息、运行时常量池等。</li><li>如类的信息（有哪些字段、方法等等）</li></ul></li></ul><h3 id=java内存模型>Java内存模型</h3><p>如果要讲Java内存模型，需要先了解硬件内存模型，因为Java内存模型实际上是一种对硬件内存模型的“重新抽象与封装”</p><p><img src=/post/jmm/image-20250323174724214.png width=1214 height=972 loading=lazy alt=image-20250323174724214 class=gallery-image data-flex-grow=124 data-flex-basis=299px></p><p>理解：</p><ul><li>线程一般来说对存在Stack的数据访问更频繁，所以Stack的数据大部分应该是在CPU寄存器、缓存中储存</li><li>而Heap中的数据访问不那么频繁，所以Heap中的数据更可能在内存中存储</li></ul><p>在硬件模型中，CPU1会将数据D从主内存放到Cache1中，假设叫D1，并对D1进行修改，CPU2从主内存中将D取到Cache2中，假设叫D2，进行修改。如果CPU1修改D1后并没有即时更新D1到主内存的D中，那么CPU2就不会获得最新的D，便产生了数据不同步问题。针对这个问题，便有了缓存一致性协议。</p><p>在Java内存模型中，可以抽象为以下模型。</p><p><img src=/post/jmm/JMM.jpeg width=1278 height=998 loading=lazy alt=img class=gallery-image data-flex-grow=128 data-flex-basis=307px></p><p>线程之间的共享变量存储在主内存（main memory）中，每个线程都有一个私有的本地内存（local memory），本地内存中存储了该线程以读 / 写共享变量的副本。</p><ol><li>所有的共享变量都存在主内存中。</li><li>每个线程都保存了一份该线程使用到的共享变量的副本。</li><li>如果线程A与线程B之间要通信的话，必须经历下面2个步骤：<ol><li>线程A将本地内存A中更新过的共享变量刷新到主内存中去。</li><li>线程B到主内存中去读取线程A之前已经更新过的共享变量。</li></ol></li></ol><p>而JMM规定，<strong>线程对共享变量的所有操作都必须在自己的本地内存中进行，不能直接从主内存中读取</strong>。即线程B需要先读取其本地内存变量，如果发现这个变量和主内存的变量不一致，才会去更新本地内存的变量，再读取本地内存的变量，<strong>而不是直接去读取主内存的变量</strong>。</p><p>而如何解决共享变量一致性问题，便是JMM的功能。</p><p>即线程如何直到本地内存的变量已经被其他线程更新？即内存是否对其他线程可见？</p><p>JMM出手：<strong>JMM通过控制主内存与每个线程的本地内存之间的交互，来提供内存可见性保证</strong>。</p><p>Java中的volatile关键字可以保证多线程操作共享变量的可见性以及禁止指令重排序，synchronized关键字不仅保证可见性，同时也保证了原子性（互斥性）。</p><h4 id=顺序一致性模型-与-java-内存模型jmm>顺序一致性模型 与 Java 内存模型（JMM）</h4><h5 id=顺序一致性模型>顺序一致性模型</h5><p>这里讲的顺序一致性模型是一种<strong>理论参考模型</strong></p><p>顺序一致性模型有两大特性：</p><ul><li>一个线程中的所有操作必须按照程序的顺序（即Java代码的顺序）来执行。</li><li>不管程序是否同步，所有线程都只能看到一个单一的操作执行顺序。即在顺序一致性模型中，每个操作必须是<strong>原子性的，且立刻对所有线程可见</strong>。</li></ul><p>也就是如果线程A有A1,A2,A3三个操作，B有B1,B2,B3三个操作，如果在顺序一致性下，无论是否同步，线程各自的执行顺序都严格保证A1-A2-A3，B1-B2-B3，并且两个线程的各自的三个<strong>操作都对任意线程可见</strong>。</p><p>思考是否有缺点：</p><ul><li>如果所有顺序都<strong>严格按照顺序串行执行</strong>，那么像处理器流水线机制是否无法发挥提高效率作用？</li><li>如果所有线程自己的操作都<strong>对所有线程可见</strong>，即每次写操作都立即刷新到主内存，这是否增大了性能开销？</li></ul><h5 id=java-内存模型jmm>Java 内存模型（JMM）</h5><p>考虑到顺序一致性模型的两个缺点，JMM内存模型并没有严格按照顺序一致性模型，而是有一些区别。</p><p><strong>如果是未同步情况：</strong></p><ul><li>顺序一致性保证单线程内的操作会按程序的顺序执行；JMM不保证单线程内的操作会按程序的顺序执行。（因为重排序，但是JMM保证单线程下的重排序不影响执行结果）</li><li>顺序一致性模型保证所有线程只能看到一致的操作执行顺序，而JMM不保证所有线程能看到一致的操作执行顺序。（因为JMM不保证所有操作立即可见）</li></ul><p><strong>如果是同步情况：</strong></p><p>我们将同步块或者同步方法包含的代码区域成为临界区（被 <code>synchronized</code> 关键字修饰)。</p><ul><li>临界区内的代码，JMM允许重排序以提高性能，只要不改变程序结果</li><li>但是不能将临界区内的写操作重排序到临界区外</li></ul><p>同时，当线程进入或者退出临界区时，会进行特殊处理，使得在临界区内程序获得与顺序一致性模型相同的内存视图。</p><ul><li><strong>进入临界区</strong>：当一个线程进入临界区时，JMM会确保该线程能看到所有之前对共享变量的修改。这通常通过刷新线程的本地缓存（从主内存中读取最新的值）来实现。</li><li><strong>退出临界区</strong>：当一个线程退出临界区时，JMM会确保该线程对共享变量的修改对其他线程可见。这通常通过将线程的本地缓存写回主内存来实现。</li></ul><p><strong>即在临界区内，线程看到的所有共享变量的值都是最新的</strong></p><h5 id=jmm对64位变量long和double的原子性处理>JMM对64位变量（long和double）的原子性处理</h5><p>JMM不保证对64位的long型和double型变量的写操作具有原子性，而顺序一致性模型保证对所有的内存读写操作都具有原子性。</p><ul><li><strong>非原子性</strong>：在JMM中，对64位的<code>long</code>和<code>double</code>类型变量的写操作<strong>不保证原子性</strong>。这意味着，如果一个线程正在写入一个<code>long</code>或<code>double</code>变量，另一个线程可能会看到该变量的<strong>部分写入值</strong>（即只看到高32位或低32位）。</li><li><strong>原因</strong>：这种设计主要是为了在某些硬件平台上提高性能。一些32位平台可能无法以原子方式处理64位数据，因此JMM选择不强制要求对<code>long</code>和<code>double</code>的写操作具有原子性。</li></ul><p>即，假设我们有一个<code>long</code>变量，其值为<code>0x123456789ABCDEF0</code>（64位）：</p><ul><li><strong>第一步</strong>：写入低32位（<code>0x9ABCDEF0</code>）。</li><li><strong>第二步</strong>：写入高32位（<code>0x12345678</code>）。</li></ul><p>如果在这个过程中没有同步机制（如<code>volatile</code>或<code>synchronized</code>），另一个线程可能会看到中间状态，例如只看到低32位被写入，而高32位仍然是旧值。</p><h4 id=最小安全性>最小安全性</h4><p>最小安全性是指，在多线程环境中，即使没有显式的同步机制，程序的行为也不会完全失控。具体来说：</p><ul><li>线程读取到的值必须是之前某个线程写入的值，或者是默认值（如<code>0</code>、<code>false</code>、<code>null</code>等）。</li><li>线程不会凭空（Out-of-Thin-Air）读取到一个完全不合理或未定义的值。</li></ul><p><strong>线程读取到的值，要么是之前某个线程写入的值，要么是默认值，不会无中生有。</strong></p><p>为了实现这个安全性，JVM在堆上分配对象时，首先会对内存<strong>空间清零</strong>，然后才会在上面分配对象（这两个操作是同步的）。</p><blockquote><p>空间清零</p><p>Memory Zeroing: 实际上翻译有所误解，Zeroing指设置默认值为0或其他默认值，并非清零</p></blockquote><h4 id=happens-before原则>happens-before原则</h4><p>为了解放程序员，让程序员在开发时尽量不用考虑内存可见和指令重排问题，JMM提供了happens-before原则，只要程序员按照这个原则写代码，则程序就能保证在JMM中具有强的内存可见性。</p><p>happens-before关系的定义如下：</p><ol><li>如果一个操作happens-before另一个操作，那么第一个操作的执行结果将对第二个操作可见，而且第一个操作的执行顺序排在第二个操作之前。</li><li><strong>两个操作之间存在happens-before关系，并不意味着Java平台的具体实现必须要按照happens-before关系指定的顺序来执行。如果重排序之后的执行结果，与按happens-before关系来执行的结果一致，那么JMM也允许这样的重排序。</strong></li></ol><p>举例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Example</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>boolean</span><span class=w> </span><span class=n>flag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>writer</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>42</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>flag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>reader</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>flag</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>x</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>如果多线程情景下，线程1执行writer()方法，线程2执行reader()方法，并没有考虑happens-before原则，会出现以下可能问题</p><ul><li><p>内存可见性问题：在多线程环境中，每个线程可能会在自己的本地缓存中操作变量，而不是直接从主内存中读取或写入。</p></li><li><p>结果</p><ul><li><code>writer</code>线程对<code>x</code>和<code>flag</code>的修改可能不会立即刷新到主内存。</li><li><code>reader</code>线程可能读取到<code>flag</code>和<code>x</code>的过期值。</li></ul></li><li><p>指令重排序问题：编译器和处理器可能会对指令进行重排序以优化性能。</p></li><li><p>结果</p><ul><li><code>writer</code>方法中的<code>x = 42</code>和<code>flag = true</code>可能会被重排序，导致<code>flag = true</code>先执行，而<code>x = 42</code>后执行。</li><li><code>reader</code>线程可能看到<code>flag</code>为<code>true</code>，但<code>x</code>的值仍然是<code>0</code>。</li></ul></li></ul><p>要实现happens-before原则，可以</p><ul><li>将<code>flag</code>声明为<code>volatile</code>，可以确保<code>writer</code>线程对<code>flag</code>的修改对<code>reader</code>线程可见，并且禁止指令重排序。</li><li>通过<code>synchronized</code>块保护<code>writer</code>和<code>reader</code>方法，可以确保内存可见性和原子性。</li><li>通过<code>Lock</code>显式控制临界区，可以确保内存可见性和原子性。</li></ul><h4 id=内存屏障>内存屏障</h4><p>内存屏障是实现happens-before关系的技术手段，而happens-before是内存屏障在JMM中的高层抽象。</p><p>内存屏障是JMM实现happens-before原则的机制。上文提到的通过<code>volatile</code>或通过<code>synchronized</code>块等方法便是使用了内存屏障机制。</p><p>后文会详解<code>volatile</code>关键字。</p><h4 id=volatitle关键字>volatitle关键字</h4><p>在Java中，volatile关键字有特殊的内存语义。volatile主要有以下两个功能：</p><ul><li>保证变量的<strong>内存可见性</strong>（即当该变量被某个线程修改之后，另一个线程可以正确获取修改后的值）</li><li>禁止volatile变量与普通变量<strong>重排序</strong>（JSR133提出，Java 5 开始才有这个“增强的volatile内存语义”）</li></ul><h5 id=具体机制>具体机制</h5><p><strong>内存可见性保证</strong></p><p>所谓内存可见性，指的是当一个线程对<code>volatile</code>修饰的变量进行<strong>写操作</strong>时，JMM会立即把该线程对应的本地内存中的共享变量的值刷新到主内存；</p><p>当一个线程对<code>volatile</code>修饰的变量进行<strong>读操作</strong>（比如step 3）时，JMM会把立即该线程对应的本地内存置为无效，从主内存中读取共享变量的值。</p><p><strong>禁止重排序</strong></p><p>在JSR133之后：严格限制编译器和处理器<strong>对volatile变量与普通变量的重排序</strong>。</p><p>如何实现：<strong>内存屏障</strong></p><h5 id=用途>用途</h5><p>在保证内存可见性这一点上，volatile有着与锁相同的内存语义，所以可以作为“轻量级”的锁来用。但是：</p><ul><li>volatile仅仅保证对单个volatile变量的读/写具有原子性</li><li>锁可以保证整个<strong>临界区代码</strong>的执行具有原子性</li></ul><h3 id=锁与synchronized>锁与synchronized</h3><p>首先需要明确的一点是：<strong>Java多线程的锁都是基于对象的</strong>，Java中的每一个对象都可以作为一个锁。</p><h4 id=synchronized关键字>Synchronized关键字</h4><p>通常使用<code>synchronized</code>关键字来给一段代码或一个方法上锁。</p><ul><li>如果加在类的普通方法上，则锁为调用该方法的实例</li><li>如果加在类的静态方法上，由于调用静态方法是通过类名调用，所以锁为当前Class对象</li><li>如果在方法里使用，锁为括号里面的对象</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 关键字在实例方法上，锁为当前实例</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>instanceLock</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// 等价于</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>blockLock</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// 关键字在静态方法上，锁为当前Class对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>classLock</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// 等价于</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>blockLock</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=na>getClass</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=c1>// 关键字在代码块上，锁为括号里面的对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>blockLock</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Object</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Object</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>o</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=class对象作为锁>Class对象作为锁</h4><p>前面提到，Java中的每一个对象都可以作为一个锁。那就有同学要问了，如果将Class对象作为锁呢？</p><p>由于每个类都有自己的Class对象，并且该类的所有实例都共享这个Class对象，所以如果将这个Class对象作为锁，则所有<strong>该类的实例都会共享这个锁</strong>，此时这个锁就不是对象级别的，而是<strong>类级别</strong>。</p><p>有两种方法可以使用Class对象作为锁：</p><p>在 Java 中，锁确实是基于对象的，而 <strong>Class 对象</strong> 也可以作为锁。Class 对象是 Java 中每个类在 JVM 中的运行时表示，每个类都有一个对应的 Class 对象。因此，Class 对象也可以作为锁来使用。</p><p>可以通过以下方式使用 Class 对象作为锁：</p><p>使用 <code>synchronized</code> 块</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Example</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>method</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>synchronized</span><span class=w> </span><span class=p>(</span><span class=n>Example</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// 使用 Class 对象作为锁</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 临界区代码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>使用 <code>synchronized</code> 静态方法，在静态方法上使用 <code>synchronized</code> 关键字时，锁是当前类的 Class 对象。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Example</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>synchronized</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>method</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// 使用 Class 对象作为锁</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 临界区代码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/java/>JAVA</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/post/thread-pool/><div class=article-details><h2 class=article-title>Java线程池(Thread Pool) - 一篇不太详细的解释</h2></div></a></article><article><a href=/post/multi-threading/><div class=article-details><h2 class=article-title>Java多线程 - 一篇不太详细的解释</h2></div></a></article><article><a href=/post/lambda/><div class=article-details><h2 class=article-title>Java基础 - 从匿名内部类到Lambda表达式再到方法引用</h2></div></a></article><article><a href=/post/texlive/><div class=article-details><h2 class=article-title>TeXLive+ VSCode 安装与环境配置</h2></div></a></article><article><a href=/post/sort-methods/><div class=article-details><h2 class=article-title>排序算法总结</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=Oddyti/Giscus data-repo-id=R_kgDOKmaUDg data-category=Announcements data-category-id=DIC_kwDOKmaUDs4CahZG data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"transparent_dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2026 Oddyti</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono&family=Long+Cang&family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@300&family=Noto+Serif+SC:wght@300&family=Zhi+Mang+Xing&display=swap" rel=stylesheet></body></html>